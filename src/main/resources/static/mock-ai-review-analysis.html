<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Analysis</title>
    <style>
        body {
            font-family: "Aptos", "Helvetica", "Arial", sans-serif;
            background-color: #f4f4f4;
            padding: 20px;
            text-align: center;
        }

        .container {
            max-width: 750px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h3 {
            color: #3f51b5;
            margin-bottom: 20px;
            font-family: "Aptos", "Arial", sans-serif;
            font-size: 13px;
        }

        textarea {
            width: 80%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-family: "Aptos", "Helvetica", "Arial", sans-serif;
            font-size: 10px;
            margin-bottom: 20px;
        }

        .link-button-row {
            display: flex;
            justify-content: right;
            align-items: center;
            margin-bottom: 20px;
        }

        a {
            color: #3f51b5;
            text-decoration: none;
            font-size: 12px;
        }

        button {
            background-color: #008CBA;
            color: white;
            border: none;
            padding: 7px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid #ccc;
        }

        th{
            padding: 10px;
            text-align: left;
            font-family: "Aptos", "Helvetica", "Arial", sans-serif;
            font-size: 11px;
            color: #3f51b5;
        }

        td {
            padding: 10px;
            text-align: left;
            font-family: "Aptos", "Helvetica", "Arial", sans-serif;
            font-size: 10px;
        }

        td.center {
            text-align: center;
            vertical-align: middle;
        }

        .result-container {
            display: none;
            margin-top: 20px;
        }

        .result-container textarea {
            height: 50px;
            font-size: 10px;
            font-family: "Aptos", "Helvetica", "Arial", sans-serif;
        }

        #sentimentBtn {
            margin: 0 50px 0 0;
        }

        .pagination {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .back-button {
            border: none;
            padding: 5px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin: 50px;
            font-family: "Aptos", "Helvetica", "Arial", sans-serif;
            font-size: 11px;
        }
    </style>
</head>
<body>
<div>
    <a href="mock-go-dashboard.html" class="back-button">Back to Dashboard</a>
    <div class="container">
        <h3>User Review Comments</h3>

        <!-- Table to display review remarks with selector buttons -->
        <table id="reviewTable">
            <thead>
            <tr>
                <th>Selector</th>
                <th>Review Remarks</th>
            </tr>
            </thead>
            <tbody id="reviewTableBody">
            <!-- Rows will be dynamically added here -->
            </tbody>
        </table>

        <!-- Pagination controls -->
        <div class="pagination">
            <button id="prevBtn" onclick="changePage(-1)" disabled>Previous</button>
            <button id="nextBtn" onclick="changePage(1)">Next</button>
        </div>

        <!-- Sentiment analysis button -->
        <div class="link-button-row">
            <button id="sentimentBtn" disabled onclick="performSentimentAnalysis()">Sentiment Analysis</button>
        </div>

        <!-- Container for sentiment analysis result -->
        <div id="sentimentResultContainer" class="result-container">
            <h3>Sentiment Analysis Result</h3>
            <textarea id="sentimentResult" readonly></textarea>
        </div>
    </div>
</div>

<script>
    // Sample review remarks for the pump (replace these with your actual remarks)
    const reviewRemarks = [
        "The pump performance is excellent, but it is a bit noisy at times.",
        "The installation process was smooth, but the manual could be clearer.",
        "Great product overall, but customer support was lacking.",
         "The pump performance is excellent, but it is a bit noisy at times.",
        "The installation process was smooth, but the manual could be clearer.",
        "Great product overall, but customer support was lacking.",
        "The pump stopped working after a few months, not satisfied.",
        "Highly efficient and saves energy, I'm very happy with it.",
        "It's a great app for people who like ads, that's why I'm giving it one star, we can't give it less anyway. However, this app deserves a negative rating between -20 and -30 stars",
        "Its fantastic experiance to the grundfos pump customer....",
        "Total crap!!! This app is garbage",
        "One big mistake and no concrete information. I had to pick up the phone and call",
        "It does not read QR codes, and when entered manually, it does not search for a popular pump.",
        "Product number wasn't recognised. Phoned Grundfos who said existing pump was OEM unit made for British Gas, despite the same model being sold on eBay. Were unable to recommend a replacement, just kept telling me to phone British Gas. So app is useless,just like Grundfos it seems. Sourced a same size uniit from the local plumb shop - job done",
        "The pump stopped working after a few months, not satisfied.",
        "Highly efficient and saves energy, I'm very happy with it.",
        "Amazing build quality and durability.",
        "Pump installation was challenging, but performance is good.",
        "Not impressed with the customer support.",
        "Pump has consistent pressure and works well under load.",
        "Pump is too loud for my liking."
    ];

    // Pagination variables
    let currentPage = 1;
    const rowsPerPage = 5;

    // Variable to store the selected review remark
    let selectedReview = "";

    // Function to populate review remarks into the table
    function populateReviewRemarks(page) {
        const reviewTableBody = document.getElementById('reviewTableBody');
        reviewTableBody.innerHTML = ''; // Clear previous rows

        // Calculate the start and end index for the current page
        const startIndex = (page - 1) * rowsPerPage;
        const endIndex = startIndex + rowsPerPage;
        const paginatedReviews = reviewRemarks.slice(startIndex, endIndex);

        paginatedReviews.forEach((remark, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
<td class="center"><input type="radio" name="reviewSelector" value="${remark}"></td>
<td>${remark}</td>
            `;
            reviewTableBody.appendChild(row);
        });

        // Add event listener to radio buttons after rendering
        const radios = document.querySelectorAll('input[name="reviewSelector"]');
        radios.forEach(radio => {
            radio.addEventListener('change', function() {
                selectedReview = this.value;
                // Enable the sentiment analysis button when a review is selected
                document.getElementById('sentimentBtn').disabled = false;
            });
        });

        // Enable/Disable pagination buttons
        document.getElementById('prevBtn').disabled = page === 1;
        document.getElementById('nextBtn').disabled = endIndex >= reviewRemarks.length;
    }

    // Function to handle pagination
    function changePage(direction) {
        currentPage += direction;
        populateReviewRemarks(currentPage);
    }

    // Function to simulate Azure AI Sentiment Analysis
    async function performSentimentAnalysis() {
        if (!selectedReview) return; // No review selected

        try {
            const response = await fetch('http://localhost:8080/sentimentAnalysis', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ reviewText: selectedReview }),
            });
            if (!response.ok){
               throw new Error(`Failed to perform sentiment analysis. Status: ${response.status}`);
            }
            const result = await response.json();
            document.getElementById('sentimentResultContainer').style.display = 'block';
            let displayResult = 'Sentiment Analysis Result:\n';
            displayResult += `Confidence Scores - Positive: ${result.confidenceScores.positive.toFixed(2)}, Negative: ${result.confidenceScores.negative.toFixed(2)}\n`;
            for(const [sentence, sentimentData] of Object.entries(result.sentenceSentiments)){
               displayResult += `\nSentence: ${sentence}\n`;
               displayResult += `sentiment: ${sentimentData.sentiment} (positive: ${sentimentData.confidenceScores.positive.toFixed(2)}, Negative: ${sentimentData.confidenceScores.negative.toFixed(2)})\n`;
            }
            document.getElementById('sentimentResult').value = displayResult;

            //if (response.ok) {
                //console.log('Response: ', response);
               // const result = await response.json(); // Get the detailed sentiment analysis result
                // Ensure the 'sentimentResultContainer' is displayed
               // document.getElementById('sentimentResultContainer').style.display = 'block';

                // Initialize the display result text
                //let displayResult = 'Sentiment Analysis Result:\n';

                // Extract overall sentiment and sentence-level analysis
                //const sentimentResult = result.documents[0];
               // displayResult += `Overall Sentiment: ${sentimentResult.sentiment}\n`;

               // sentimentResult.sentences.forEach(sentence => {
                   // displayResult += `\nSentence: ${sentence.text}\n`;
                   // displayResult += `Sentiment: ${sentence.sentiment} (Positive: ${sentence.confidenceScores.positive.toFixed(2)}, Negative: ${sentence.confidenceScores.negative.toFixed(2)})\n`;
                //});

                // Populate the result into the text area
                //document.getElementById('sentimentResult').value = displayResult;
            //} else {
                //console.error('Failed to perform sentiment analysis:', response.statusText);
                //document.getElementById('sentimentResult').value = 'Error performing sentiment analysis. Please try again.';
               // document.getElementById('sentimentResultContainer').style.display = 'block';
            //}
        } catch (error) {
            const result = await response.json();
            console.log('plain text repsonse: ', result);
            console.error('Error performing sentiment analysis:', error);
            document.getElementById('sentimentResult').value = 'Error performing sentiment analysis. Please try again.';
            document.getElementById('sentimentResultContainer').style.display = 'block';
        }
    }
    // Populate the first page of review remarks when the page loads
    window.onload = () => populateReviewRemarks(currentPage);
</script>

</body>
</html>